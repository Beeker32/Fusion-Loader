(async () => {
    // Ensure that the script executes only after the document is fully loaded
    window.onload = async function() {
        const endButton = document.getElementById('endDino');
        
        if (endButton) {
            endButton.onclick = async function() {
                // Load SweetAlert if it's not already loaded
                if (!window.Swal) {
                    const script = document.createElement('script');
                    script.src = "https://cdn.jsdelivr.net/npm/sweetalert2@11";
                    document.head.appendChild(script);
                    await new Promise(resolve => script.onload = resolve);
                }

                // Define the hack function
                const hack = Boot.prototype.game;

                async function endDinoDig() {
                    const dinoState = hack._state._states.get("DinoDig");
                    
                    if (!dinoState?.timer?.addTime) {
                        await Swal.fire({
                            icon: 'error',
                            title: 'Error',
                            text: 'You are not in Dino Dig.',
                            confirmButtonText: 'OK'
                        });
                        return;
                    }

                    // Subtract a huge amount of time to effectively end the game
                    dinoState.timer.addTime(-9e15); // Subtract 285,388.1278538812694 years

                    await Swal.fire({
                        toast: true,
                        position: 'bottom',
                        icon: 'success',
                        title: 'The Dino Dig game has been ended.',
                        showConfirmButton: true,
                        confirmButtonText: 'OK',
                        timer: 5000,
                        timerProgressBar: true
                    });
                }

                // Execute the function
                await endDinoDig();
            };
        } else {
            console.error('Button with id "endDino" not found.');
        }
    };
})();
